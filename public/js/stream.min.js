var ActivityStream = function() {
    this.stream = [], this.html = "";
};

ActivityStream.prototype.push = function(item) {
    this.stream.push(item);
}, ActivityStream.prototype.toString = function() {
    this.stream.sort(function(a, b) {
        return parseFloat(b.id) - parseFloat(a.id);
    });
    for (var i = 0; i < this.stream.length; i++) this.html += this.stream[i].toString();
    return this.html;
};

var ActivityItem = function(date, html) {
    this.id = +date, this.html = html;
};

ActivityItem.prototype.toString = function() {
    return this.html;
}, ActivityStream.prototype.tumblr = function(username, avatar) {
    var updateStream, formatTumble, url = "http://" + username + ".tumblr.com/api/read/json";
    return updateStream = function(data) {
        for (var data = data.posts, i = 0; i < data.length; i++) {
            var date = new Date(data[i].date);
            this.stream.push(new ActivityItem(date, '<div class="activity-entry"><div class="activity-content">' + formatTumble(data[i]) + '<span class="date">' + data[i].date + "</span></div></div>"));
        }
    }, formatTumble = function(data) {
        var tumbleContent = "<div class='avatar' style='background: url(" + avatar + ")'></div>";
        switch (data.type) {
          case "regular":
            tumbleContent += "<h4>" + data["regular-title"] + "</h4>" + " " + data["regular-body"];
            break;

          case "photo":
            tumbleContent += "<img src='" + data["photo-url-1280"] + "' class='tumblr-image' />" + data["photo-caption"];
            break;

          case "quote":
            tumbleContent += "type: quote";
            break;

          case "link":
            tumbleContent += "<h4>" + data["link-text"] + "</h4>" + "<p><a href='" + data["link-url"] + "' target='_blank'>" + data["link-text"] + "</a></p>" + data["link-description"];
            break;

          case "chat":
            tumbleContent = "type: chat";
            break;

          case "audio":
            tumbleContent = "type: audio";
            break;

          case "video":
            tumbleContent = "type: video";
        }
        return tumbleContent;
    }, $.ajax({
        url: url,
        dataType: "jsonp",
        success: function(data) {
            updateStream(data);
        }
    });
};